<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Adaptive Music Creator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #2c1810 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: white;
            animation: quantumShift 10s ease-in-out infinite alternate;
        }

        @keyframes quantumShift {
            0% { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #2c1810 100%); }
            50% { background: linear-gradient(135deg, #2c1810 0%, #667eea 50%, #764ba2 100%); }
            100% { background: linear-gradient(135deg, #764ba2 0%, #2c1810 50%, #667eea 100%); }
        }

        .container {
            max-width: 1400px;
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%);
            pointer-events: none;
            animation: quantumField 8s ease-in-out infinite alternate;
        }

        @keyframes quantumField {
            0% { opacity: 0.3; transform: rotate(0deg); }
            100% { opacity: 0.6; transform: rotate(180deg); }
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.8em;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #fff, #a8edea, #fed6e3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }

        .quantum-status {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
        }

        .quantum-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .qubit-visualization {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .qubit {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 10px;
            display: inline-block;
            position: relative;
            animation: quantumSpin 3s linear infinite;
        }

        .qubit.superposition {
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(120,119,198,0.6) 50%, rgba(255,119,198,0.4) 100%);
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .qubit.entangled {
            background: radial-gradient(circle, rgba(255,119,198,0.8) 0%, rgba(120,255,198,0.6) 50%, rgba(255,255,119,0.4) 100%);
            box-shadow: 0 0 20px rgba(255,119,198,0.5);
        }

        @keyframes quantumSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .entanglement-visualization {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            min-height: 200px;
        }

        .entanglement-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ff77c7, #77c7ff, transparent);
            animation: entanglementPulse 2s ease-in-out infinite;
        }

        @keyframes entanglementPulse {
            0%, 100% { opacity: 0.3; transform: scaleX(0.5); }
            50% { opacity: 1; transform: scaleX(1); }
        }

        .mood-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            z-index: 1;
            position: relative;
        }

        .mood-button {
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.4s ease;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .mood-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
        }

        .mood-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .mood-button:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .mood-button.active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            z-index: 1;
            position: relative;
        }

        .control-button {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .control-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
        }

        .control-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .quantum-visualizer {
            height: 250px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .quantum-wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: conic-gradient(from 0deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #ff6b6b);
            animation: quantumWave 3s ease-in-out infinite;
            transform-origin: bottom;
            opacity: 0.7;
        }

        @keyframes quantumWave {
            0%, 100% { 
                transform: scaleY(0.2) rotate(0deg); 
                filter: hue-rotate(0deg);
            }
            25% { 
                transform: scaleY(0.8) rotate(90deg); 
                filter: hue-rotate(90deg);
            }
            50% { 
                transform: scaleY(1.2) rotate(180deg); 
                filter: hue-rotate(180deg);
            }
            75% { 
                transform: scaleY(0.6) rotate(270deg); 
                filter: hue-rotate(270deg);
            }
        }

        .parameters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }

        .parameter-group {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .parameter-group h3 {
            margin-bottom: 15px;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .slider-container {
            margin-bottom: 15px;
        }

        .slider-container label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.95em;
            color: rgba(255, 255, 255, 0.9);
        }

        .slider {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            outline: none;
            appearance: none;
            -webkit-appearance: none;
            transition: all 0.3s ease;
        }

        .slider:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #ff77c7, #77c7ff);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(255, 119, 199, 0.4);
        }

        .status {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            position: relative;
            z-index: 1;
        }

        .mood-info {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            position: relative;
            z-index: 1;
        }

        .emoji {
            font-size: 2em;
            margin-right: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }

        .quantum-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            position: relative;
        }

        .quantum-spinner::before,
        .quantum-spinner::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            animation: quantumSpinnerPuls 2s ease-in-out infinite;
        }

        .quantum-spinner::before {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(255,119,198,0.8) 0%, transparent 70%);
            animation-delay: 0s;
        }

        .quantum-spinner::after {
            width: 40px;
            height: 40px;
            top: 10px;
            left: 10px;
            background: radial-gradient(circle, rgba(119,198,255,0.8) 0%, transparent 70%);
            animation-delay: 0.5s;
        }

        @keyframes quantumSpinnerPuls {
            0%, 100% { transform: scale(0.8) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.3; }
        }

        .quantum-info {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            z-index: 1;
        }

        .quantum-info h3 {
            color: #ff77c7;
            margin-bottom: 10px;
        }

        .quantum-metric {
            display: inline-block;
            margin: 5px 10px;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🌌 Quantum Adaptive Music Creator</h1>
        
        <div class="quantum-status" id="quantum-status">
            Quantum State: Initialized | Coherence: 100% | Entanglement: Ready
        </div>

        <div class="quantum-display">
            <div class="qubit-visualization">
                <h3>Quantum Qubits</h3>
                <div id="qubits-container">
                    <div class="qubit superposition" title="Melody Qubit"></div>
                    <div class="qubit superposition" title="Harmony Qubit"></div>
                    <div class="qubit superposition" title="Rhythm Qubit"></div>
                    <div class="qubit superposition" title="Timbre Qubit"></div>
                </div>
            </div>
            
            <div class="entanglement-visualization">
                <h3>Quantum Entanglement</h3>
                <div id="entanglement-display">
                    <div class="entanglement-line" style="top: 30%; left: 10%; width: 80%;"></div>
                    <div class="entanglement-line" style="top: 60%; left: 20%; width: 60%;"></div>
                </div>
            </div>
        </div>
        
        <div class="mood-selection">
            <button class="mood-button" data-mood="happy">
                <span class="emoji">😊</span> Happy
            </button>
            <button class="mood-button" data-mood="sad">
                <span class="emoji">😢</span> Sad
            </button>
            <button class="mood-button" data-mood="energetic">
                <span class="emoji">⚡</span> Energetic
            </button>
            <button class="mood-button" data-mood="relaxed">
                <span class="emoji">😌</span> Relaxed
            </button>
            <button class="mood-button" data-mood="romantic">
                <span class="emoji">💕</span> Romantic
            </button>
            <button class="mood-button" data-mood="mysterious">
                <span class="emoji">🌙</span> Mysterious
            </button>
        </div>

        <div class="mood-info" id="mood-info">
            Select a mood to begin quantum music generation
        </div>

        <div class="controls">
            <button class="control-button" id="play-btn">▶️ Play</button>
            <button class="control-button" id="pause-btn" disabled>⏸️ Pause</button>
            <button class="control-button" id="stop-btn" disabled>⏹️ Stop</button>
            <button class="control-button" id="regenerate-btn" disabled>🔄 Quantum Regenerate</button>
            <button class="control-button" id="collapse-btn" disabled>📡 Collapse Wave Function</button>
        </div>

        <div class="loading" id="loading">
            <div class="quantum-spinner"></div>
            <p>Quantum processing... Collapsing wave functions...</p>
        </div>

        <div class="quantum-visualizer">
            <div class="quantum-wave" id="quantum-visualizer"></div>
        </div>

        <div class="quantum-info">
            <h3>Quantum Music Metrics</h3>
            <div id="quantum-metrics">
                <span class="quantum-metric">Superposition Degree: <span id="superposition-value">0%</span></span>
                <span class="quantum-metric">Entanglement Strength: <span id="entanglement-value">0%</span></span>
                <span class="quantum-metric">Coherence Time: <span id="coherence-value">∞</span></span>
                <span class="quantum-metric">Quantum Noise: <span id="noise-value">0%</span></span>
            </div>
        </div>

        <div class="status" id="status">
            Quantum system ready - Select a mood to begin quantum music generation
        </div>

        <div class="parameters">
            <div class="parameter-group">
                <h3>Classical Parameters</h3>
                <div class="slider-container">
                    <label>Tempo: <span id="tempo-value">120</span> BPM</label>
                    <input type="range" class="slider" id="tempo-slider" min="60" max="180" value="120">
                </div>
                <div class="slider-container">
                    <label>Volume: <span id="volume-value">50</span>%</label>
                    <input type="range" class="slider" id="volume-slider" min="0" max="100" value="50">
                </div>
            </div>
            
            <div class="parameter-group">
                <h3>Quantum Parameters</h3>
                <div class="slider-container">
                    <label>Quantum Coherence: <span id="coherence-value-slider">80</span>%</label>
                    <input type="range" class="slider" id="coherence-slider" min="0" max="100" value="80">
                </div>
                <div class="slider-container">
                    <label>Entanglement Degree: <span id="entanglement-degree-value">60</span>%</label>
                    <input type="range" class="slider" id="entanglement-slider" min="0" max="100" value="60">
                </div>
            </div>

            <div class="parameter-group">
                <h3>Quantum Effects</h3>
                <div class="slider-container">
                    <label>Superposition Mix: <span id="superposition-mix-value">70</span>%</label>
                    <input type="range" class="slider" id="superposition-slider" min="0" max="100" value="70">
                </div>
                <div class="slider-container">
                    <label>Quantum Uncertainty: <span id="uncertainty-value">30</span>%</label>
                    <input type="range" class="slider" id="uncertainty-slider" min="0" max="100" value="30">
                </div>
            </div>
        </div>
    </div>

    <script>
        class QuantumAdaptiveMusicCreator {
            constructor() {
                this.currentMood = null;
                this.isPlaying = false;
                this.synths = {};
                this.sequence = null;
                this.reverb = null;
                this.quantumState = {
                    qubits: [],
                    entangledPairs: [],
                    coherenceTime: Infinity,
                    superpositionStates: new Map()
                };
                this.initializeQuantumSystem();
                this.initializeAudio();
                this.setupEventListeners();
                this.moodParameters = this.initializeMoodParameters();
                this.updateQuantumDisplay();
            }

            initializeQuantumSystem() {
                // Initialize 4 qubits for different musical dimensions
                this.quantumState.qubits = [
                    { id: 'melody', state: [Math.random(), Math.random()], entangled: false },
                    { id: 'harmony', state: [Math.random(), Math.random()], entangled: false },
                    { id: 'rhythm', state: [Math.random(), Math.random()], entangled: false },
                    { id: 'timbre', state: [Math.random(), Math.random()], entangled: false }
                ];

                // Create quantum entanglement between pairs
                this.quantumState.entangledPairs = [
                    [0, 1], // melody-harmony entanglement
                    [2, 3]  // rhythm-timbre entanglement
                ];

                this.updateQuantumMetrics();
            }

            // Quantum random number generator using quantum-inspired algorithms
            quantumRandom(min = 0, max = 1) {
                const coherence = parseFloat(document.getElementById('coherence-slider').value) / 100;
                const uncertainty = parseFloat(document.getElementById('uncertainty-slider').value) / 100;
                
                // Simulate quantum superposition collapse
                let qValue = 0;
                for (let i = 0; i < 8; i++) {
                    qValue += Math.random() * coherence + (1 - coherence) * Math.random() * uncertainty;
                }
                qValue = (qValue / 8) % 1;
                
                return min + qValue * (max - min);
            }

            // Quantum entanglement effect on musical parameters
            applyQuantumEntanglement(qubit1, qubit2) {
                const entanglementStrength = parseFloat(document.getElementById('entanglement-slider').value) / 100;
                
                if (entanglementStrength > 0) {
                    const correlation = Math.cos(qubit1.state[0] - qubit2.state[0]) * entanglementStrength;
                    qubit1.state[1] = correlation;
                    qubit2.state[1] = -correlation;
    
                    qubit1.entangled = true;
                    qubit2.entangled = true;
    
                    return correlation;
                } else {
                    return 0;  // FIX: return 0 when no entanglement
            }}

            // Quantum superposition for note selection
            quantumSuperposition(options) {
                const superpositionMix = parseFloat(document.getElementById('superposition-slider').value) / 100;
                
                if (superpositionMix === 0) {
                    return options[Math.floor(Math.random() * options.length)];
                }
                
                // Create superposition of multiple states
                const weights = options.map(() => this.quantumRandom());
                const totalWeight = weights.reduce((sum, w) => sum + w, 0);
                const normalizedWeights = weights.map(w => w / totalWeight);
                
                const rand = this.quantumRandom();
                let cumulative = 0;
                
                for (let i = 0; i < options.length; i++) {
                    cumulative += normalizedWeights[i];
                    if (rand <= cumulative) {
                        // Store superposition state
                        this.quantumState.superpositionStates.set(Date.now(), {
                            options,
                            weights: normalizedWeights,
                            selected: options[i]
                        });
                        return options[i];
                    }
                }
                
                return options[options.length - 1];
            }

            updateQuantumMetrics() {
                const superposition = parseFloat(document.getElementById('superposition-slider').value);
                const entanglement = parseFloat(document.getElementById('entanglement-slider').value);
                const coherence = parseFloat(document.getElementById('coherence-slider').value);
                const uncertainty = parseFloat(document.getElementById('uncertainty-slider').value);

                document.getElementById('superposition-value').textContent = superposition + '%';
                document.getElementById('entanglement-value').textContent = entanglement + '%';
                document.getElementById('coherence-value').textContent = coherence > 95 ? '∞' : (coherence / 10).toFixed(1) + 's';
                document.getElementById('noise-value').textContent = uncertainty + '%';

                // Update quantum status
                const status = coherence > 70 ? 'Coherent' : coherence > 40 ? 'Partially Coherent' : 'Decoherent';
                document.getElementById('quantum-status').textContent = 
                    `Quantum State: ${status} | Coherence: ${coherence}% | Entanglement: ${entanglement > 50 ? 'Strong' : 'Weak'}`;
            }

            updateQuantumDisplay() {
                const qubits = document.querySelectorAll('.qubit');
                qubits.forEach((qubit, index) => {
                    const state = this.quantumState.qubits[index];
                    if (state && state.entangled) {
                        qubit.className = 'qubit entangled';
                    } else {
                        qubit.className = 'qubit superposition';
                    }
                });

                // Update entanglement visualization
                const entanglementLines = document.querySelectorAll('.entanglement-line');
                const entanglementStrength = parseFloat(document.getElementById('entanglement-slider').value) / 100;
                
                entanglementLines.forEach(line => {
                    line.style.opacity = entanglementStrength;
                    line.style.animationDuration = (2 - entanglementStrength) + 's';
                });
            }

            async initializeAudio() {
                try {
                    // Create quantum-enhanced reverb
                    this.reverb = new Tone.Reverb({
                        decay: 2 + this.quantumRandom(0, 2),
                        wet: 0.3 + this.quantumRandom(0, 0.4)
                    }).toDestination();
                    
                    // Create quantum-influenced synthesizers
                    this.synths = {
                        lead: new Tone.Synth({
                            oscillator: { 
                                type: this.quantumSuperposition(["triangle", "sine", "square", "sawtooth"])
                            },
                            envelope: { 
                                attack: 0.1 * this.quantumRandom(0.5, 2), 
                                decay: 0.2 * this.quantumRandom(0.5, 2), 
                                sustain: 0.5 * this.quantumRandom(0.5, 1.5), 
                                release: 1 * this.quantumRandom(0.5, 2) 
                            }
                        }).connect(this.reverb),
                        
                        bass: new Tone.Synth({
                            oscillator: { 
                                type: this.quantumSuperposition(["sawtooth", "square", "triangle"])
                            },
                            envelope: { 
                                attack: 0.1 * this.quantumRandom(0.8, 1.2), 
                                decay: 0.3 * this.quantumRandom(0.8, 1.5), 
                                sustain: 0.8 * this.quantumRandom(0.7, 1), 
                                release: 0.5 * this.quantumRandom(0.8, 1.5) 
                            }
                        }).connect(this.reverb),
                        
                        pad: new Tone.Synth({
                            oscillator: { 
                                type: this.quantumSuperposition(["sine", "triangle"])
                            },
                            envelope: { 
                                attack: 0.5 * this.quantumRandom(0.5, 2), 
                                decay: 0.2 * this.quantumRandom(0.8, 1.5), 
                                sustain: 0.7 * this.quantumRandom(0.8, 1.2), 
                                release: 2 * this.quantumRandom(0.5, 1.5) 
                            }
                        }).connect(this.reverb),
                        
                        percussion: new Tone.NoiseSynth({
                            noise: { 
                                type: this.quantumSuperposition(["white", "pink", "brown"])
                            },
                            envelope: { 
                                attack: 0.01 * this.quantumRandom(0.5, 2), 
                                decay: 0.1 * this.quantumRandom(0.8, 1.5), 
                                sustain: 0 
                            }
                        }).connect(this.reverb)
                    };

                    console.log("Quantum audio system initialized successfully");
                } catch (error) {
                    console.error("Quantum audio initialization failed:", error);
                }
            }

            initializeMoodParameters() {
                return {
                    happy: {
                        key: 'C',
                        scale: ['C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5'],
                        tempo: 140,
                        quantumBias: 0.8, // Higher probability for major intervals
                        chords: [['C4', 'E4', 'G4'], ['F4', 'A4', 'C5'], ['G4', 'B4', 'D5'], ['C4', 'E4', 'G4']],
                        rhythm: [0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5],
                        bassPattern: ['C2', 'F2', 'G2', 'C2'],
                        quantumComplexity: 0.6
                    },
                    sad: {
                        key: 'Am',
                        scale: ['A3', 'B3', 'C4', 'D4', 'E4', 'F4', 'G4', 'A4'],
                        tempo: 80,
                        quantumBias: 0.3, // Lower probability for resolution
                        chords: [['A3', 'C4', 'E4'], ['F3', 'A3', 'C4'], ['G3', 'B3', 'D4'], ['A3', 'C4', 'E4']],
                        rhythm: [0, 1, 2, 3],
                        bassPattern: ['A1', 'F1', 'G1', 'A1'],
                        quantumComplexity: 0.4
                    },
                    energetic: {
                        key: 'E',
                        scale: ['E4', 'F#4', 'G#4', 'A4', 'B4', 'C#5', 'D#5', 'E5'],
                        tempo: 160,
                        quantumBias: 0.9, // High energy quantum states
                        chords: [['E4', 'G#4', 'B4'], ['A4', 'C#5', 'E5'], ['B4', 'D#5', 'F#5'], ['E4', 'G#4', 'B4']],
                        rhythm: [0, 0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.25, 2.5, 2.75, 3, 3.25, 3.5, 3.75],
                        bassPattern: ['E2', 'A2', 'B2', 'E2'],
                        quantumComplexity: 0.9
                    },
                    relaxed: {
                        key: 'G',
                        scale: ['G3', 'A3', 'B3', 'C4', 'D4', 'E4', 'F#4', 'G4'],
                        tempo: 90,
                        quantumBias: 0.5, // Balanced quantum states
                        chords: [['G3', 'B3', 'D4'], ['C4', 'E4', 'G4'], ['D4', 'F#4', 'A4'], ['G3', 'B3', 'D4']],
                        rhythm: [0, 2],
                        bassPattern: ['G1', 'C2', 'D2', 'G1'],
                        quantumComplexity: 0.3
                    },
                    romantic: {
                        key: 'F',
                        scale: ['F3', 'G3', 'A3', 'Bb3', 'C4', 'D4', 'E4', 'F4'],
                        tempo: 100,
                        quantumBias: 0.7, // Warm quantum resonances
                        chords: [['F3', 'A3', 'C4'], ['Bb3', 'D4', 'F4'], ['C4', 'E4', 'G4'], ['F3', 'A3', 'C4']],
                        rhythm: [0, 0.75, 1.5, 2.25, 3],
                        bassPattern: ['F1', 'Bb1', 'C2', 'F1'],
                        quantumComplexity: 0.5
                    },
                    mysterious: {
                        key: 'Dm',
                        scale: ['D3', 'E3', 'F3', 'G3', 'A3', 'Bb3', 'C4', 'D4'],
                        tempo: 110,
                        quantumBias: 0.2, // Uncertain quantum states
                        chords: [['D3', 'F3', 'A3'], ['Gm3', 'Bb3', 'D4'], ['A3', 'C4', 'E4'], ['D3', 'F3', 'A3']],
                        rhythm: [0, 1, 2.5, 3.5],
                        bassPattern: ['D1', 'G1', 'A1', 'D1'],
                        quantumComplexity: 0.8
                    }
                };
            }

            setupEventListeners() {
                // Mood selection
                document.querySelectorAll('.mood-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        this.selectMood(e.target.dataset.mood);
                    });
                });

                // Control buttons
                document.getElementById('play-btn').addEventListener('click', () => this.play());
                document.getElementById('pause-btn').addEventListener('click', () => this.pause());
                document.getElementById('stop-btn').addEventListener('click', () => this.stop());
                document.getElementById('regenerate-btn').addEventListener('click', () => this.quantumRegenerateMusic());
                document.getElementById('collapse-btn').addEventListener('click', () => this.collapseWaveFunction());

                // Classical parameter sliders
                document.getElementById('tempo-slider').addEventListener('input', (e) => {
                    document.getElementById('tempo-value').textContent = e.target.value;
                    if (this.currentMood && this.isPlaying) {
                        Tone.Transport.bpm.value = parseInt(e.target.value);
                    }
                });

                document.getElementById('volume-slider').addEventListener('input', (e) => {
                    const volume = parseInt(e.target.value);
                    document.getElementById('volume-value').textContent = volume;
                    const dbValue = -60 + (volume * 0.6);
                    Object.values(this.synths).forEach(synth => {
                        synth.volume.value = dbValue;
                    });
                });

                // Quantum parameter sliders
                document.getElementById('coherence-slider').addEventListener('input', (e) => {
                    document.getElementById('coherence-value-slider').textContent = e.target.value;
                    this.updateQuantumMetrics();
                    this.updateQuantumDisplay();
                });

                document.getElementById('entanglement-slider').addEventListener('input', (e) => {
                    document.getElementById('entanglement-degree-value').textContent = e.target.value;
                    this.applyQuantumEntanglement(this.quantumState.qubits[0], this.quantumState.qubits[1]);
                    this.applyQuantumEntanglement(this.quantumState.qubits[2], this.quantumState.qubits[3]);
                    this.updateQuantumMetrics();
                    this.updateQuantumDisplay();
                });

                document.getElementById('superposition-slider').addEventListener('input', (e) => {
                    document.getElementById('superposition-mix-value').textContent = e.target.value;
                    this.updateQuantumMetrics();
                });

                document.getElementById('uncertainty-slider').addEventListener('input', (e) => {
                    document.getElementById('uncertainty-value').textContent = e.target.value;
                    this.updateQuantumMetrics();
                });
            }

            selectMood(mood) {
                // Update UI
                document.querySelectorAll('.mood-button').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-mood="${mood}"]`).classList.add('active');
                
                this.currentMood = mood;
                const moodEmojis = {
                    happy: '😊',
                    sad: '😢',
                    energetic: '⚡',
                    relaxed: '😌',
                    romantic: '💕',
                    mysterious: '🌙'
                };

                document.getElementById('mood-info').innerHTML = `
                    <span class="emoji">${moodEmojis[mood]}</span>
                    Current Mood: ${mood.charAt(0).toUpperCase() + mood.slice(1)} (Quantum Enhanced)
                `;

                // Update parameters based on mood with quantum influence
                const params = this.moodParameters[mood];
                const quantumTempo = params.tempo + (this.quantumRandom(-20, 20) * params.quantumBias);
                document.getElementById('tempo-slider').value = Math.round(quantumTempo);
                document.getElementById('tempo-value').textContent = Math.round(quantumTempo);

                // Adjust quantum parameters based on mood
                document.getElementById('superposition-slider').value = Math.round(params.quantumComplexity * 100);
                document.getElementById('superposition-mix-value').textContent = Math.round(params.quantumComplexity * 100);

                document.getElementById('status').textContent = `Quantum mood set to ${mood}. Wave function prepared for collapse!`;
                
                // Enable controls
                document.getElementById('play-btn').disabled = false;
                document.getElementById('regenerate-btn').disabled = false;
                document.getElementById('collapse-btn').disabled = false;

                this.generateQuantumMusic();
            }

            async generateQuantumMusic() {
                if (!this.currentMood) return;

                this.showLoading(true);
                
                try {
                    const params = this.moodParameters[this.currentMood];
                    
                    // Quantum state preparation
                    this.prepareQuantumStates(params);
                    
                    // Clear existing sequence
                    if (this.sequence) {
                        this.sequence.dispose();
                    }

                    // Set quantum-influenced tempo
                    const quantumTempo = params.tempo + (this.quantumRandom(-10, 10) * params.quantumBias);
                    Tone.Transport.bpm.value = quantumTempo;

                    // Create quantum-enhanced musical sequences
                    this.createQuantumMelodySequence(params);
                    this.createQuantumBassSequence(params);
                    this.createQuantumChordSequence(params);
                    
                    // Add quantum percussion for energetic moods
                    if (this.currentMood === 'energetic' || this.quantumRandom() > 0.7) {
                        this.createQuantumPercussionSequence(params);
                    }

                    document.getElementById('status').textContent = `Quantum music generated for ${this.currentMood} mood! Wave function collapsed successfully.`;
                    
                } catch (error) {
                    console.error("Quantum music generation failed:", error);
                    document.getElementById('status').textContent = "Quantum decoherence detected. Please try again.";
                } finally {
                    this.showLoading(false);
                }
            }

            prepareQuantumStates(params) {
                // Prepare qubits with mood-specific quantum states
                this.quantumState.qubits.forEach((qubit, index) => {
                    const angle = (params.quantumBias + this.quantumRandom(-0.2, 0.2)) * Math.PI;
                    qubit.state[0] = Math.cos(angle / 2);
                    qubit.state[1] = Math.sin(angle / 2);
                });

                // Apply entanglement
                this.quantumState.entangledPairs.forEach(([i, j]) => {
                    this.applyQuantumEntanglement(this.quantumState.qubits[i], this.quantumState.qubits[j]);
                });
            }

            createQuantumMelodySequence(params) {
                const complexity = parseFloat(document.getElementById('superposition-slider').value) / 100;
                const melodyQubit = this.quantumState.qubits[0];
                
                // Generate quantum-influenced melody
                const notes = this.generateQuantumMelody(params.scale, complexity, melodyQubit);
                
                new Tone.Sequence((time, note) => {
                    if (note) {
                        // Apply quantum uncertainty to note timing
                        const quantumDelay = this.quantumRandom(-0.02, 0.02);
                        this.synths.lead.triggerAttackRelease(note, '8n', time + quantumDelay);
                    }
                }, notes, '8n').start(0);
            }

            createQuantumBassSequence(params) {
                const bassQubit = this.quantumState.qubits[1];
                const quantumBassPattern = params.bassPattern.map(note => {
                    // Quantum superposition of bass notes
                    if (this.quantumRandom() < bassQubit.state[0]) {
                        return note;
                    } else {
                        // Quantum jump to related note
                        const alternatives = this.getQuantumAlternatives(note, params.scale);
                        return this.quantumSuperposition(alternatives);
                    }
                });
                
                new Tone.Sequence((time, note) => {
                    const quantumDelay = this.quantumRandom(-0.01, 0.01);
                    this.synths.bass.triggerAttackRelease(note, '4n', time + quantumDelay);
                }, quantumBassPattern, '2n').start(0);
            }

            createQuantumChordSequence(params) {
                const harmonyQubit = this.quantumState.qubits[2];
                const quantumChords = params.chords.map(chord => {
                    // Apply quantum superposition to chord voicings
                    return chord.map(note => {
                        if (this.quantumRandom() < harmonyQubit.state[1]) {
                            return note;
                        } else {
                            // Quantum voice leading
                            const alternatives = this.getQuantumAlternatives(note, params.scale);
                            return this.quantumSuperposition(alternatives);
                        }
                    });
                });
                
                new Tone.Sequence((time, chord) => {
    if (chord && Array.isArray(chord)) {  
        chord.forEach((note, index) => {
            const quantumDelay = this.quantumRandom(-0.005, 0.005);
            this.synths.pad.triggerAttackRelease(note, '2n', time + index * 0.01 + quantumDelay);
        });
    }  
}, quantumChords, '1m').start(0);
            }

            createQuantumPercussionSequence(params) {
                const rhythmQubit = this.quantumState.qubits[3];
                const quantumRhythm = [];
                
                // Generate quantum rhythm pattern
                for (let i = 0; i < 16; i++) {
                    const probability = Math.abs(rhythmQubit.state[0]) * params.quantumComplexity;
                    quantumRhythm.push(this.quantumRandom() < probability ? 1 : 0);
                }
                
                new Tone.Sequence((time, velocity) => {
                    if (velocity) {
                        const quantumDelay = this.quantumRandom(-0.005, 0.005);
                        this.synths.percussion.triggerAttackRelease('16n', time + quantumDelay);
                    }
                }, quantumRhythm, '16n').start(0);
            }

            generateQuantumMelody(scale, complexity, qubit) {
                const length = Math.floor(16 * complexity) + 8;
                const melody = [];
                let lastNote = 0;
                
                for (let i = 0; i < length; i++) {
                    const quantumProbability = Math.abs(qubit.state[0]) * complexity;
                    
                    if (this.quantumRandom() > 0.15) { // 85% chance of note
                        // Quantum walk through scale
                        const quantumStep = this.quantumRandom() < quantumProbability ? 
                            Math.floor(this.quantumRandom(-2, 3)) : 
                            Math.floor(this.quantumRandom(-1, 2));
                        
                        lastNote = Math.max(0, Math.min(scale.length - 1, lastNote + quantumStep));
                        melody.push(scale[lastNote]);
                    } else {
                        melody.push(null); // Quantum rest
                    }
                }
                
                return melody;
            }

            getQuantumAlternatives(note, scale) {
                const noteIndex = scale.indexOf(note);
                if (noteIndex === -1) return [note];
                
                const alternatives = [note];
                
                // Add quantum alternatives (neighboring scale degrees)
                if (noteIndex > 0) alternatives.push(scale[noteIndex - 1]);
                if (noteIndex < scale.length - 1) alternatives.push(scale[noteIndex + 1]);
                
                return alternatives;
            }

            quantumRegenerateMusic() {
                this.stop();
                
                // Quantum state reset with new random phases
                this.quantumState.qubits.forEach(qubit => {
                    qubit.state = [this.quantumRandom(), this.quantumRandom()];
                });
                
                document.getElementById('status').textContent = "Quantum regeneration initiated...";
                this.generateQuantumMusic();
            }

            collapseWaveFunction() {
                if (!this.currentMood) return;
                
                // Collapse all superposition states to definite values
                this.quantumState.qubits.forEach(qubit => {
                    const probability = Math.random();
                    qubit.state = probability > 0.5 ? [1, 0] : [0, 1];
                });
                
                // Update display
                this.updateQuantumDisplay();
                document.getElementById('status').textContent = "Wave function collapsed! Quantum states are now definite.";
                
                // Regenerate music with collapsed states
                this.generateQuantumMusic();
            }

            async play() {
                try {
                    if (Tone.context.state !== 'running') {
                        await Tone.start();
                    }
                    
                    Tone.Transport.start();
                    this.isPlaying = true;
                    
                    document.getElementById('play-btn').disabled = true;
                    document.getElementById('pause-btn').disabled = false;
                    document.getElementById('stop-btn').disabled = false;
                    
                    document.getElementById('status').textContent = `Playing quantum ${this.currentMood} music...`;
                    this.startQuantumVisualizer();
                    
                } catch (error) {
                    console.error("Quantum playback failed:", error);
                    document.getElementById('status').textContent = "Quantum playback failed. System decoherence detected.";
                }
            }

            pause() {
                Tone.Transport.pause();
                this.isPlaying = false;
                
                document.getElementById('play-btn').disabled = false;
                document.getElementById('pause-btn').disabled = true;
                
                document.getElementById('status').textContent = "Quantum music paused - maintaining coherence";
                this.stopQuantumVisualizer();
            }

            stop() {
                Tone.Transport.stop();
                this.isPlaying = false;
                
                document.getElementById('play-btn').disabled = false;
                document.getElementById('pause-btn').disabled = true;
                document.getElementById('stop-btn').disabled = true;
                
                document.getElementById('status').textContent = "Quantum music stopped - system reset";
                this.stopQuantumVisualizer();
            }

            startQuantumVisualizer() {
                const visualizer = document.getElementById('quantum-visualizer');
                visualizer.style.animationPlayState = 'running';
                
                // Quantum-inspired color patterns
                const quantumColors = [
                    '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', 
                    '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'
                ];
                let colorIndex = 0;
                
                this.visualizerInterval = setInterval(() => {
                    const coherence = parseFloat(document.getElementById('coherence-slider').value) / 100;
                    const entanglement = parseFloat(document.getElementById('entanglement-slider').value) / 100;
                    
                    // Quantum interference pattern
                    const color1 = quantumColors[colorIndex % quantumColors.length];
                    const color2 = quantumColors[(colorIndex + Math.floor(entanglement * 4)) % quantumColors.length];
                    
                    visualizer.style.background = `conic-gradient(from ${colorIndex * 45}deg, ${color1}, ${color2}, ${color1})`;
                    visualizer.style.filter = `hue-rotate(${this.quantumRandom(0, 360)}deg) brightness(${0.7 + coherence * 0.5})`;
                    
                    colorIndex = (colorIndex + 1) % quantumColors.length;
                }, 300 + this.quantumRandom(100, 400));
            }

            stopQuantumVisualizer() {
                const visualizer = document.getElementById('quantum-visualizer');
                visualizer.style.animationPlayState = 'paused';
                
                if (this.visualizerInterval) {
                    clearInterval(this.visualizerInterval);
                }
            }

            showLoading(show) {
                document.getElementById('loading').style.display = show ? 'block' : 'none';
            }
        }

        // Initialize the quantum application
        document.addEventListener('DOMContentLoaded', () => {
            new QuantumAdaptiveMusicCreator();
        });
    </script>
</body>
</html>